!function(){"use strict";angular.module("iqfy").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).factory("CommentFactory",["$resource",function(e){return e("/comments/:offeringid/:channelid/:postid/:commentid",{offeringid:"@offeringid",channelid:"@channelid",postid:"@postId",commentid:"@commentid"})}]).factory("PostFactory",["$resource",function(e){return e("/channels/:offeringid/:channelid",{offeringid:"@offeringid",channelid:"@channelid"})}]).factory("VoteFactory",["$resource",function(e){return e("/comments/:offeringid/:channelid/:postid/:commentid/vote.json",{offeringid:"@offeringid",channelid:"@channelid",postid:"@postId",commentid:"@commentid"},{save:{method:"POST",ignoreLoadingBar:!0}})}]).factory("ReadPostsInChannel",["$resource",function(e){return e("/readposts/:offeringid/:channelid",{offeringid:"@offeringid",channelid:"@channelid"})}]).factory("UserListInOffering",["$resource",function(e){return e("/course/:offeringid/members",{offeringid:"@offeringid"},{get:{method:"GET",cache:!0}})}]).factory("UnsubscribeFactory",["$resource",function(e){return e("/channels/unsubscribe")}])}(),function(){"use strict";function e(e,t,n,i,s){function r(e,t){return e&&t&&["name","fullName","avatarURL","bio","bioUrl"].forEach(function(n){e[n]=t[n]}),e}return{getPost:function(n,i,o){var a={offeringid:n,channelid:i,postid:o},c=t("/posts/:offeringid/:channelid/:postid",a);return e.all([s.get({offeringid:n}).$promise,c.get({}).$promise]).then(function(e){var t=e[0],n=e[1];return r(n,t[n.userId])})},getPosts:function(n,o){var a={offeringid:n,channelid:o},c=t("/posts/:offeringid/:channelid",a);return e.all([s.get({offeringid:n}).$promise,c.query().$promise]).then(function(e){var t=e[0],n=e[1];return i.map(n,function(e){return r(e,t[e.userId])})})},getComments:function(r,o,a,c){var l={offeringid:r,channelid:o,postid:a},u=t("/comments/:offeringid/:channelid/:postid",l);return e.all([s.get({offeringid:r}).$promise,u.query().$promise]).then(function(e){var t=e[0],s=e[1];return i.map(s,function(e){return angular.isDefined(t[e.userId])&&(e.userName=t[e.userId].name,e.userFullName=t[e.userId].fullName),e.canVote=e.userId&&c!==e.userId,e.hasVoted=!1,e.votes&&(e.hasVoted=!0===e.votes[c]),e.nbVotes=i.findEnabledKeys(e.votes).length||0,e.createdAtTimeAgo=n(e.createdAt).fromNow(),e})})}}}angular.module("iqfy").factory("CourseDiscussionsFactory",["$q","$resource","moment","_","UserListInOffering",e])}(),function(){"use strict";angular.module("iqfy").factory("CourseDiscussionsHelper",["$i18next","toastr",function(e,t){return{pinger:"",onAnyError:function(){setTimeout(function(){t.error(e.t("RefreshPageTryAgain"),e.t("SomethingWentWrong"),{onclick:function(){window.location.reload(!0)}})},5e3)},on404Error:function(){t.info(e.t("PostNotFound"),e.t("SomethingWentWrong"),{onclick:function(){window.location.href=window.location.pathname}})},getAvatar:function(e){if(e&&void 0!==e)return void 0!==e.moderation&&!0===e.moderation.muted&&void 0!==e.moderation.moderator?e.moderation.moderator.avatarURL:e.avatarURL},getPostTitle:function(t){if(void 0!==t){var n=t.title;if(void 0!==t.moderation&&!0===t.moderation.muted){var i=t.moderation;i.moderator=i.moderator||{},n=e.t("ThisPostHiddenRepliesClosedByName",{ModeratedByName:i.moderator.first+" "+i.moderator.last})}return n}}}}])}(),function(){"use strict";angular.module("iqfy").factory("FeedbackOfferingAPI",["$resource",function(e){return e("/course/:offeringid/:pageid/feedback.json",{offeringid:"@offeringid",pageid:"@pageid"},{save:{method:"POST",ignoreLoadingBar:!0}})}])}(),function(){"use strict";angular.module("iqfy").service("IFrameOfferingAPI",["$resource","offering",function(e,t){return e("/course/:offeringid/iframe/",{offeringid:t.id},{update:{method:"PUT"}})}])}(),function(){"use strict";angular.module("iqfy").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).factory("SubmissionAssignmentAPI",["$resource",function(e){return e("/api/v1/submission/:offeringid/assignment/:assessmentid")}])}(),function(){"use strict";angular.module("iqfy").config(["$routeProvider",function(e){e.when("/talk/:channelid",{templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController"}).when("/talk/:channelid/:postid",{templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController"}).when("/talk/:channelid/:postid/:commentid",{templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController"}).when("/page/:pageid/quiz/start",{templateUrl:"/ng-assets/app/templates/Quiz/QuizTemplate.html",controller:"QuizIndexController"}).when("/page/:pageid/quiz/start/calendar",{templateUrl:"/ng-assets/app/templates/Quiz/QuizTemplate.html",controller:"QuizIndexController"}).when("/page/:pageid/quiz/questions",{templateUrl:"/ng-assets/app/templates/Quiz/QuizTemplate.html",controller:"QuizQuestionsController"}).when("/page/:pageid/quiz/review/",{templateUrl:"/ng-assets/app/templates/Quiz/QuizTemplate.html",controller:"QuizReviewController"}).when("/page/:pageid/quiz/results/",{templateUrl:"/ng-assets/app/templates/Quiz/QuizTemplate.html",controller:"QuizResultsController"}).when("/page/:pageid/discussion/:commentid",{templateUrl:"/ng-assets/app/templates/Learn/CoursePageTemplate.html",controller:"CoursePageController"}).when("/page/:pageid",{templateUrl:"/ng-assets/app/templates/Learn/CoursePageTemplate.html",controller:"CoursePageController",resolve:{controllerName:function(){}}}).when("/studynotes",{templateUrl:"/ng-assets/app/templates/Learn/StudyNotesTemplate.html",controller:"StudyNotesController"}).when("/:tab",{templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController"}).when("/:progress/pulse/:answeredpulse",{templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController"}).when("/assessments/:assignmentid",{templateUrl:"/ng-assets/app/templates/Learn/CourseAssignmentTemplate.html",controller:"CourseAssignmentController"}).when("/assessments/:assignmentid/calendar",{templateUrl:"/ng-assets/app/templates/Learn/CourseAssignmentTemplate.html",controller:"CourseAssignmentController"}).otherwise({templateUrl:"/ng-assets/app/templates/Learn/CourseHomeTemplate.html",controller:"CourseHomeController",resolve:{controllerName:function(){}}})}])}(),function(){"use strict";angular.module("iqfy").controller("CourseHomeController",["_","$scope","$routeParams","offering","vocab","iqfy","MixpanelHelper","$sce","updateUrl","IFrameSettingsService","$rootScope","$uibModal","$timeout","$location","moment","LTISettings","SideNavService","UserService","$injector","toastr","$i18next","$window","PlaylistTransform",function(e,t,n,i,s,r,o,a,c,l,u,d,f,g,m,p,v,S,h,b,y,P,w){t.vocab=s,t.iqfy=r,t.channelId=n.channelid,t.postId=n.postid,t.commentId=n.commentid,t.answeredPulseId=n.answeredpulse,t.studyPlanV2="study-plan-v2"===n.tab,t.trustAsHtml=a.trustAsHtml,t.iFrameSettingsService=l,t.offering=i,t.timezone="Pacific/Auckland",t.sideNavService=v,t.addingFirstPage=!1;try{t.ClassConsoleService=h.get("ClassConsoleService")}catch(e){t.ClassConsoleService=null}r&&r.orgSettings&&r.orgSettings.timezone&&(t.timezone=r.orgSettings.timezone),t.toggle={searchPanel:!1,socialNotesPanel:!1},t.subscription=t.sideNavService.toggleSocialNotesPanel$.subscribe(function(){t.toggle.socialNotesPanel=!t.toggle.socialNotesPanel}),t.hasChannelData=function(){return t.contentService.channels&&t.contentService.channels.channelData&&!t.offlineService.offline&&Object.keys(t.contentService.channels.channelData).length},t.availableTabs={0:"overview",1:"contents",2:"talk",3:"assessments",4:"progress",5:"feedback_marking",6:"integration",7:"studynotes",8:"tasks",9:"search",10:"class",11:"downloads",12:"studyPlanV2",13:"classConsole",selected:0},t.isCourseOverviewSelected=function(){var e=t.availableTabs;return!e.selected||"overview"===e[e.selected]},t.tabRedirectChecker=function(){if(n.answeredpulse)t.availableTabs.selected=0;else if(n.channelid)t.availableTabs.selected=2;else if(t.studyPlanV2)t.availableTabs.selected=12;else if(n.tab){var i=parseInt(e.findKey(t.availableTabs,e.partial(e.isEqual,n.tab))),s=!!r.buildMode||("talk"!==n.tab||t.contentService.hasAccessToTalk());!isNaN(i)&&s?t.availableTabs.selected=i:window.location.hash="#/overview"}},t.$watch("availableTabs.selected",function(e,n){t.offlineService.offline&&e!==n&&t.availableTabs[e]&&c(t.availableTabs[e],!1)}),t.addToCalendarSettings={},t.getAddToCalendarSettings=function(e){var n=e.$key,i=t.addToCalendarSettings[n];if(i)return i;var s={startDate:t.assessmentStartDateForCalendar(e),dueDate:t.getAssessmentDueDate(e),timezone:t.timezone,title:e.title+" assessment reminder",description:t.getAssessmentDescription(e,!1)};return t.addToCalendarSettings[n]=s,s},t.setActiveTab=function(e){c(t.availableTabs[e],!1)},t.showFeedbackMarkingTab=function(){return!r.buildMode&&!t.offlineService.offline&&(t.contentService&&t.contentService.offering&&t.userService.isFacilitatorOfOffering(t.contentService.offering.offeringId)||t.contentService&&t.contentService.isMarkerOfOffering()||t.contentService&&t.contentService.isEvaluatorOfOffering())},t.showProgressTab=function(){return r.orgSettings.allowLearnerProgressAccess&&!r.buildMode&&!t.offlineService.offline},t.togglePopover=function(e){f(function(){angular.element("#avatar-"+e+" a.avatar-link").triggerHandler("click")})},$(document).on("keyup",function(e){"Escape"===e.key&&(t.toggle.searchPanel=!1,t.toggle.socialNotesPanel=!1)}),t.toggleSearchPanel=function(){t.toggle.searchPanel=!t.toggle.searchPanel},t.canEditIntegration=function(){return r.orgSettings.allowFacilitatorsIntegrationsOnCourseOverview&&!r.buildMode&&!t.offlineService.offline&&t.userService&&t.userService.isFacilitatorOfOffering(i.id)&&t.contentService&&t.contentService.offering&&!t.contentService.offering.offeringReadOnly},t.$on("$destroy",function(){u.isCourseHome&&delete u.isCourseHome,t.subscription.unsubscribe(),t.contentServiceAddNewPageSubscription&&t.contentServiceAddNewPageSubscription.unsubscribe()}),t.continueCourseUrl=function(){var e=t.userService.getLastVisitedCoursePage(i.id);return t.contentService.getPageUrl(e)},t.editIFrameSettings=function(){t.contentService&&t.contentService.offering&&t.contentService.offering.extraEmbed&&"iframe"==t.contentService.offering.extraEmbed.type&&(l.vm=angular.copy(t.contentService.offering.extraEmbed),l.showEmbedModal=!0)},t.getLTIObject=function(){if(t.contentService&&t.contentService.offering&&t.contentService.offering.extraEmbed&&"lti"==t.contentService.offering.extraEmbed.type)return t.contentService.offering.extraEmbed.settings.link=a.trustAsResourceUrl("/course/"+i.id+"/lti/"),t.contentService.offering.extraEmbed.settings},t.editLTIItem=function(){p.openModal("overview")},t.fireMixpanelEvent=function(e){r.buildMode&&o.isAvailable()&&o.tracker.track("Build: Start course clicked",{org:o.data.org,distinct_id:o.data.id,contentId:e,userRole:t.userService.isReviewerOfCourse(e)?"reviewer":"builder"})},t.previewSectionAndPage=function(){t.contentService.isPublished||t.fireMixpanelEvent(t.contentService.offering.offeringId);var e=t.contentService.offering.offeringURL||"/build/course/preview/"+i.id+"/";window.location.href=e+"start/"},t.addFirstSectionAndPage=function(){t.addingFirstPage=!0,t.contentService.waitingRequest=!0,t.contentServiceAddNewPageSubscription=t.contentService.addNewPage().subscribe(function(e){t.addingFirstPage=!1,t.contentService.waitingRequest=!1,o.isAvailable()&&o.tracker.track("Build: Add new page",{contentId:t.contentService.contentId,pageId:t.contentService.pageId,buttonName:"course overview startCourse"}),window.location.href="/create/#/builder/preview/"+t.contentService.contentId+"/"+e},function(e){b.error(y.t("SomethingWentWrongPleaseRefreshPage"))})},t.goToCourse=function(){var n=w.flattenise(t.contentService.playlist),i=e.get(t.contentService,"settings.allowTasks"),s=e.filter(n,function(t){return(!i||!e.get(t,"quiz"))&&"Page"===t.structure});return s.length>0?s[0].id?P.location.href="/build/course/preview/"+t.baseVm.contentId+"/"+s[0].id:P.location.href="/build/course/preview/"+t.baseVm.contentId+"/start":t.addFirstSectionAndPage()},t.assessmentStartDateForCalendar=function(e){var n=t.getAssessmentDueDate(e);if(n)return m(n).tz(t.timezone).subtract("1","hours").format()},t.getAssessmentLink=function(e,n){var i="";if("quiz"===e.type||"summative_quiz"===e.type){if(r.buildMode)return t.contentService.offering.offeringURL+e.pid;i=e.pid?t.contentService.offering.offeringURL+"#/page/"+e.pid+"/quiz/start":e.url}else e.type&&-1===["upload","externalProvider","openResponse","video"].indexOf(e.type)||(i=t.contentService.offering.offeringURL+"#/assessments/"+e.$key);return n?window.location.origin+""+i+"/calendar":i},t.getAssessmentDescription=function(e,n){return n?"Your assessment "+e.title+" for "+t.contentService.offering.name+" is due. \n\nYou can log in to iQualify and view your assessment at "+t.getAssessmentLink(e,!0):a.trustAsHtml('<p>Your assessment <a href="'+t.getAssessmentLink(e,!0)+'">'+e.title+"</a> for "+t.contentService.offering.name+" is due.</p><p>You can log in to your study at "+t.userService._details.org+".iqualify.com</p>")},t.getAssessmentDueDate=function(e){var t=S._details;return t.submissions&&t.submissions.extensions&&t.submissions.extensions[i.id]&&t.submissions.extensions[i.id][e.pid]&&t.submissions.extensions[i.id][e.pid][e.id]?t.submissions.extensions[i.id][e.pid][e.id]:e.dueDate||e.due_date||""},t.$watch("contentService.ready",function(){t.contentService.ready&&t.tabRedirectChecker(),n.tab&&"feedback_marking"===n.tab&&t.contentService&&t.contentService.ready&&!t.contentService.areTasksEnabled()&&g.path("/class/")})}])}(),function(){"use strict";angular.module("iqfy").controller("CoursePageController",["$rootScope","$scope","$routeParams","$location","$sce","$window","$timeout","$resource","UserService","ContentService","offering","iqfy","SocialAnnotationsService","StudyNotesService","PlaylistTransform","$uibModal","FeedbackOfferingAPI","toastr","keywordHighlighter","LTISettings","$i18next","SocialNotesService","StudyNotesService","SideNavService",function(e,t,n,i,s,r,o,a,c,l,u,d,f,g,m,p,v,S,h,b,y,P,w,C){function I(){t.loading=!0,l.getPage(t.offeringId,t.pageId).then(function(){if(c.setLastVisitedCoursePage(t.offeringId,t.pageId),t.contentService.currentPage=t.contentService.pages[t.pageId],r.iqfy.pageData=r.iqfy.pageData||{},t.contentService.currentPage&&t.contentService.currentPage.sectionData){r.iqfy.pageId=t.contentService.currentPage.sectionData.id,r.iqfy.pageData.sectionTitle=t.contentService.currentPage.sectionData.title;-1!==["summative_quiz","practice_quiz"].indexOf(t.contentService.currentPage.sectionData.type)&&i.path("/page/"+t.pageId+"/quiz/start");var e,n=i.search().keywords;"content_page"==t.contentService.currentPage.sectionData.type&&(t.tmplName="",t.content=t.contentService.currentPage.content,n&&n.length&&(e=n.split("|"),t.sideNavService.currentNavItem="search",t.content=h.highlight(e,t.content)),o(function(){P.init(t.offeringId,t.pageId),w.init(t.offeringId,t.pageId)}))}t.contentService.editingState=d.editingState,t.loading=!1,o(function(){var e=t.contentService.offering.metadata.rootContentId;r.applyGlossarizer(e),r.applyGists();var n={offeringid:u.id,pageid:t.pageId};a("/api/v1/course/track/:offeringid/:pageid",n,{save:{method:"POST",ignoreLoadingBar:!0}}).save(),t.contentService.userPlaylist=m.updateById(t.contentService.userPlaylist,t.pageId,{visited:!0}),t.markers=t.contentService&&t.contentService.offering?t.contentService.offering.markers||{}:{}})},function(e){t.loading=!1,t.error=!0,S.error(y.t("ErrorLoadingTryAgain"))})}function k(e){v.save({offeringid:u.id,pageid:n.pageid},e,function(){})}t.offering=u,t.offeringId=u.id,t.iqfy=d,t.pageId=n.pageid,t.$sce=s,t.trustAsHtml=s.trustAsHtml,t.contentService=l,t.$routeParams=n,t.tmplName="",t.toggle={showCourseNotes:!1,showFullReadOnlyText:!1,socialNotesPanel:!1},t.markers={},t.sideNavService=C,t.sideNavService.currentNavItem="content",t.subscription=t.sideNavService.toggleSocialNotesPanel$.subscribe(function(){t.toggle.socialNotesPanel=!t.toggle.socialNotesPanel}),t.$watch("$routeParams.pageid",function(e,n){var i;l.currentPage&&l.currentPage.sectionData&&(i=l.currentPage.sectionData.id);try{i=l.pages[e].sectionData.id}catch(e){}if(i&&l.status[t.offeringId]&&"pending"!==l.status[t.offeringId][e]||!l.status[t.offeringId]||!l.status[t.offeringId][e]||"error"==l.status[t.offeringId][e]){var s=function(){if(!0===t.contentService.ready)return I();o(function(){s()},100)};s()}}),t.$watch("$routeParams.idm",function(e,i){n.idm&&l.status[t.offeringId]&&"ready"===l.status[t.offeringId][n.pageid]&&I()}),t.getLTIObject=function(){if(t.contentService&&t.contentService.currentPage&&t.contentService.currentPage.LTIObject)return t.contentService.currentPage.LTIObject.link=s.trustAsResourceUrl("/course/"+u.id+"/lti/"+l.currentPage.LTIObject.integrationId),t.contentService.currentPage.LTIObject},t.editLTIItem=function(){b.openModal("page")},t.toggleSearchPanel=function(){t.toggle.searchPanel=!t.toggle.searchPanel},t.trustSrc=function(e){return s.trustAsResourceUrl(e)},$(document).on("keyup",function(e){"Escape"===e.key&&(t.toggle.searchPanel=!1,t.toggle.socialNotesPanel=!1)}),t.$on("$destroy",function(){t.contentService&&delete l.status[t.offeringId][n.pageid],t.subscription.unsubscribe()}),t.upVote=function(){if("thumbs-up"!==t.contentService.currentPage.learnerFeedback){t.contentService.currentPage.learnerFeedback="thumbs-up";k({vote:"thumbs-up"})}},t.downVote=function(){if("thumbs-down"!==t.contentService.currentPage.learnerFeedback){t.contentService.currentPage.learnerFeedback="thumbs-down";k({vote:"thumbs-down"})}},t.openStudyNoteOnInit=function(e){return n.idm===e.elementId},t.isLegacyElement=function(e){return"activity"===e.type&&t.tasksEnabled()||"task"===e.type&&!t.tasksEnabled()},t.tasksEnabled=function(){return t.contentService.areTasksEnabled()}}])}(),function(){"use strict";angular.module("iqfy").controller("CourseAssignmentController",["_","$scope","$rootScope","$routeParams","$window","offering","iqfy","$sce","SubmissionAssignmentAPI","humanFilesizeService","$i18next","SideNavService",function(e,t,n,i,s,r,o,a,c,l,u,d){function f(){t.visibleFiles=e.filter(t.assignment.files,function(e){return!(e.hidden||e.deleted)}),t.assignment.fileCount=e.size(t.visibleFiles)}function g(){c.get({offeringid:t.offering.id,assessmentid:t.assignmentid},function(n){if(t.assignment=e.extend({},t.assignment,n),f(),t.submitted="submitted"===t.assignment.status,t.hasMarkedFiles=!!(t.assignment.OLMData&&t.assignment.OLMData.markedDocuments&&t.assignment.OLMData.markedDocuments.length||t.assignment.archivedSubmissions),t.assessmentUploadsIsClosed=t.assignment.assessmentUploadsIsClosed,t.submittedResponseData=n,t.reopened="open"===t.assignment.status&&t.hasMarkedFiles,t.submitted||!1!==t.assignment.pastOpenDate||!1!==t.assignment.pastDueDate||(t.assignment.status="Not open yet"),t.assignment.openResponseFiles||(t.assignment.openResponseFiles=[]),t.assignment.archivedSubmissions){var i=e.chain(t.assignment.archivedSubmissions).map(function(e){return e&&e.files?Object.keys(e.files):null}).filter(function(e){return e}).flattenDeep().uniq().value(),s={};i.forEach(function(n){var i=e.find(t.assignment.archivedSubmissions,function(e){return e&&e.files&&e.files[n]});s[n]=i.files[n]}),t.previouslyUploadedFiles=s,t.previouslyUploadedFileCount=Object.keys(s||{}).length,t.assignment.files=e.pickBy(t.assignment.files,function(e,t){return!(-1!==i.indexOf(t))}),f()}},function(e){})}t.iqfy=o,t.offering=r,t.trustAsHtml=a.trustAsHtml,t.assignmentid=i.assignmentid,t.humanFilesize=l.humanFilesize,t.csrf=s._csrf,t.submittedResponseData="",t.filepickerMaxFileSize=o.orgSettings.filepicker&&o.orgSettings.filepicker.assignments&&o.orgSettings.filepicker.assignments.maxSize?o.orgSettings.filepicker.assignments.maxSize:50,t.removeCustomClass=!0,t.toggle={searchPanel:!1,socialNotesPanel:!1},t.sideNavService=d,t.sideNavService.currentNavItem="assessments",t.subscription=t.sideNavService.toggleSocialNotesPanel$.subscribe(function(){t.toggle.socialNotesPanel=!t.toggle.socialNotesPanel}),$(document).on("keyup",function(e){"Escape"===e.key&&(t.toggle.searchPanel=!1,t.toggle.socialNotesPanel=!1)}),t.getAssessment=function(){return void 0!==t.assignment?t.assignment:t.contentService&&t.contentService.offering&&t.contentService.offering.assessments&&t.contentService.offering.assessments[t.assignmentid]?(t.assignment=t.contentService.offering.assessments[t.assignmentid],t.assignment.open=!t.assignment.pastDueDate&&t.assignment.pastOpenDate,g(),t.assignment):{}},t.getUploadAssessmentBtnLabel=function(){return t.getAssessment().fileCount>0?u.t("AddAnotherFile"):u.t("AddFile")},t.getOpenResponseFilesUploadBtnLabel=function(){return t.getAssessment().openResponseFiles.length>0?u.t("AddAnotherFile"):u.t("AddFile")},t.getAssessmentStatusLabel=function(){var e=t.getAssessment().status;return"open"==e?u.t("Open").toLowerCase():"submitted"==e?u.t("Submitted").toLowerCase():"closed"==e?u.t("Closed").toLowerCase():e},t.getVideoAssessmentCount=function(){var e=t.getAssessment().videos;return Object.keys(e||{}).length},t.$on("file-added",function(e,n){void 0===t.assignment.files&&(t.assignment.files={}),t.assignment.files.temp=n,f(),g()}),t.$on("file-removed",function(e,n){delete t.assignment.files[n],t.assignment.files.length&&delete t.assignment.files,f()}),t.$on("video-added",function(e,n){void 0===t.assignment.videos&&(t.assignment.videos={}),t.assignment.videos.temp=n,g()}),t.$on("video-removed",function(e,n){delete t.assignment.videos[n],t.assignment.videos.length&&delete t.assignment.videos}),t.$on("assignment-submitted",function(e,n){t.submitted=!0,t.assignment.status="submitted"}),t.$on("$destroy",function(){t.subscription.unsubscribe()}),t.simpleUploadFile=function(e){var i=e.target.files,s=$('<span class="loading">'),r=$('<div class="upload-alert alert alert-warning">'),o=e.target,a=i[0],c=1024*t.filepickerMaxFileSize*1024,l=a.size>c?"FileIsTooLarge":"FileNameInvalid";if($(".upload-alert").remove(),a.size>c||a.name.match(/[^\u0000-\u007F]/g))return r.clone().text(u.t(l)).insertBefore($(o)),void $(".uploads :file").val("");var d=$(o).parents(".assignment-upload-container");$.ajax(d.data("upload-url"),{files:d.find(":file"),data:d.serializeArray(),iframe:!0,cache:!1,processData:!1,beforeSend:function(){s.clone().insertAfter($(o))}}).always(function(e){$(".loading").remove(),e&&!1!==e.ok?n.$broadcast("file-added",{filename:a.name,size:a.size,createdAt:new Date}):r.clone().text(e.message).insertBefore($(o)),$(".uploads :file").val("")})}}])}(),function(){"use strict";angular.module("iqfy").controller("StudyNotesController",["$scope","ContentService","offering","StudyNotesService","_","$i18next","SideNavService","toastr",function(e,t,n,i,s,r,o,a){var c=n.id;e.offering=n,e.toggle={searchPanel:!1,socialNotesPanel:!1},e.sideNavService=o,e.subscription=e.sideNavService.toggleSocialNotesPanel$.subscribe(function(){e.toggle.socialNotesPanel=!e.toggle.socialNotesPanel}),o.currentNavItem="studynotes",t.ready?e.contentService=t:t.init(c).then(function(){e.contentService=t},function(t){e.error=!0}),i.getNotes(c).then(function(t){e.usedTags=s.chain(t).flatten("tags").uniq().value(),e.studyNotes=t,e.emptyStudyNotes=0===s.size(t)},function(t){e.error=t}),e.deleteStudyNote=function(e){if(!window.confirm(r.t("RemoveStudyNoteDeletedPermanently?")))return!1;var t=$("[data-clipping-uid="+e+"]");i.deleteNote(c,e).then(function(e){t.parents(".clipping").fadeOut("fast",function(){$(this).remove()})},function(e){a.error(r.t("FailedRequest"))})},e.getStudyNoteHeading=function(e){if(e.title)return s.truncate(e.title,{length:100,separator:" "});if(e.userNote)return s.truncate(e.userNote,{length:100,separator:" "});if(e.elementType){var t="";switch(e.elementType){case"html":t="Text";break;case"video":t="Video";break;case"codeSnippet":t="CodeSnippet";break;case"activity":t="Activity";break;case"externalTool":t="ExternalTool";break;case"iframe":t="Webpage";break;case"gallery":t="Images"}return r.t(t)}},e.findNotesByTag=function(){e.searchFilter||(e.searchFilter={}),e.searchFilter.tags=this.tag},e.clearSearchFilter=function(){e.searchFilter={}}}])}();